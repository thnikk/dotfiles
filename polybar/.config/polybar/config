; vim:ft=dosini
; Polybar config
; Most settings are inherited from the default bar.
;
; For easier configuration, icons, monitors, and colors were each broken into their own section.

[monitor]
main = DisplayPort-1
secondary = DisplayPort-2

[icons]
eth = " "
kbd = " "
mpc = " "
cpu = " "
mem = " "
upd = " "
vol = " "
clock = " "
date = " "
temp = " "
hot = " "
fan = " "
drv = " "
bat = " "
gpu = " "
vol0 = " "
vol1 = " "
vol2 = " "
vol3 = " "
mail = " "
mopen = ""
mclose = ""

[colors]
background = #1c1f26
background-alt = #2b303b
foreground = #d8dee9
foreground-alt = #747C84
blue = #cc8fa1b3
purple = #ccb48ead
green = #cca3be8c
orange = #ccd08770
brown = #ccab7967
yellow = #ccebcb8b
aqua = #cc96b5b4
red = #ccbf616a
blank = #00000000

[bar/default]
enable-ipc = true
override-redirect = false
wm-restack = bspwm
height = 26
offset-x = 0%
offset-y = 0%
fixed-center = true
bottom = true

#tray-position = right
#tray-padding = 1

border-top      = 0
border-bottom   = 0
border-left     = 0
border-right    = 0
border-color    = ${colors.blank}
radius          = 0
line-size       = 2

background = ${colors.background}
foreground = ${colors.foreground}

padding-left = 0
padding-right = 0

module-margin-left = 0
module-margin-right = 0

font-0 = Operator Mono Light:pixelsize=12;2
font-1 = Source Han Sans JP:size=10:antialias=true;2
font-2 = Material Icons:pixelsize=12;4

modules-left =  i3 bspwm keypad
modules-center = time date weather gmail mpc mpd
modules-right = rec update pulseaudio cputemp cpu mem kbd net bat

cursor-click = pointer
cursor-scroll = ns-resize

[bar/bar1]
inherit = bar/default
monitor = ${monitor.main}
height = 30

; Override module positioning
modules-right = vm update pulseaudio kbd net

separator = %{F#747C84}|%{F-}

; Make fonts bigger
font-0 = Operator Mono Book:pixelsize=14;2
font-1 = Source Han Sans JP:size=12:antialias=true;2
font-2 = Material Icons:pixelsize=12;3

[bar/bar2]
; Follow bar 1 since same system
inherit = bar/bar1
monitor = ${monitor.secondary}

; Override tray positioning
tray-position = right
tray-background = ${colors.background-alt}

; Override module placement
modules-left = i3 bspwm
modules-right = cputemp cpu gpu mem
modules-center =

[module/general]
interval = 60
format-background = ${colors.background}
format-padding = 1

[module/volnew]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/volume.sh
tail = true
interval = 0.1

[module/gmail]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/polybar-gmail/launch.py -p "" -ns
tail = true
click-left = $TERMINAL neomutt

[module/keypad]
inherit = module/general
type = custom/script
format = <label>
label = "%{A1:~/.local/bin/ukp 2k:}2K%{A} %{A1:~/.local/bin/ukp 4k:}4K%{A} %{A1:~/.local/bin/ukp 7k:}7K%{A} %{A1:~/.local/bin/ukp 2kt:}2KT%{A} %{A1:~/.local/bin/ukp 4kt:}4KT %{A}%{A1:~/.local/bin/ukp fb:}FB%{A}"
exec = echo 1
exec-if = ls /dev/ttyACM*

interval = 1

[module/rec]
inherit = module/general
type = custom/script
format = <label>
label = "%output%"
format-foreground = ${colors.red}
exec = echo ""
exec-if = ps aux | grep ffmpeg | grep screencast | grep -v grep
interval = 1

[module/kbd]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.kbd}
format-prefix-foreground = ${colors.foreground-alt}
label = "%output%"
exec = /home/thnikk/.config/polybar/scripts/kb.sh
exec-if = pgrep ibus-daemon
interval = 1

[module/gm]
inherit = module/general
type = custom/script
format = <label>
label = %output%
exec = echo " Gamemode "
exec-if = gamemoded -s | grep "gamemode is active"
interval = 1
format-background = ${colors.blue}

[module/ds4]
inherit = module/general
type = custom/script
format = <label>
format-prefix = " "
format-prefix-foreground = ${colors.foreground-alt}
label = %output%%
exec = cat "/sys/class/power_supply/sony_controller_battery*/capacity"
exec-if = cat "/sys/class/power_supply/sony_controller_battery*/capacity"
interval = 1

[module/bat]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.bat}
format-prefix-foreground = ${colors.foreground-alt}
format-foreground = ${colors.foreground}
exec = ~/.config/polybar/scripts/battery.sh
exec-if = test -d /sys/class/power_supply/BAT0
interval = 60

[module/storage]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.drv}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = df / | sed -n 2p | awk 'NR==1{print $5}'
interval = 10

[module/df]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.drv}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = ~/.config/polybar/scripts/df.sh
interval = 1

[module/time]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.clock}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = date +%I:%M
interval = 60

[module/date]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.date}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = ~/.config/polybar/scripts/time.sh
interval = 60

; Custom module for memory values more consistent with other programs
[module/mem]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.mem}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = ~/.config/polybar/scripts/mem.sh
interval = 5

; Custom module for listing active VMs
[module/vm]
inherit = module/general
type = custom/script
format = <label>
label = %output%
exec = sudo virsh list --name
exec-if = sudo virsh list --all | grep running
tail = false
interval = 3

[module/xwindow]
inherit = module/general
type = internal/xwindow
label = %title:0:30:...%

[module/xkeyboard]
inherit = module/general
type = internal/xkeyboard
blacklist-0 = num lock

format-prefix = "${icons.kbd}"
format-prefix-foreground = ${colors.foreground-alt}
format-prefix-underline = ${colors.blue}

label-layout = %layout%
label-layout-underline = ${colors.blue}

;label-indicator-padding = 2
;label-indicator-margin = 1
label-indicator-background = ${colors.blue}
label-indicator-underline = ${colors.blue}

;click-left = ~/.config/polybar/kbd.sh

[module/bspwm]
type = internal/bspwm
inherit = module/i3
label-empty =
label-occupied-padding-right = 1
label-occupied-background = ${colors.background}

[module/i3]
type = internal/i3
format = <label-state><label-mode>
index-sort = true
wrapping-scroll = false

; Only show workspaces on the same output as the bar
pin-workspaces = true

label-mode-foreground = ${colors.foreground}
label-mode-background = ${colors.red}

label-unfocused-padding-right = 1
label-unfocused-background = ${colors.background-alt}

; focused = Active workspace on focused monitor
label-focused-padding-right = 1
label-focused-foreground = ${colors.background}
label-focused-background = ${colors.blue}

; visible = Active workspace on unfocused monitor
label-visible-foreground = ${colors.background}
label-visible-background = ${colors.foreground-alt}
label-visible-padding-right = 1

; urgent = Workspace with urgency hint set
label-urgent-background = ${colors.red}
label-urgent-padding-right = 1

; Same as internal module default, but is disabled when song isn't playing
[module/mpc]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.mpc}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = mpc current
exec-if = mpc | grep playing
tail = false
interval = 1

click-left = mpc toggle
scroll-up = mpc vol +5
scroll-down = mpc vol -5

[module/cpu]
inherit = module/general
type = internal/cpu
interval = 5
label = %percentage:2%%

[module/net]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/net.sh
format-prefix = ${icons.eth}
format-prefix-foreground = ${colors.foreground-alt}
interval = 1

[module/pulseaudio]
inherit = module/general
type = internal/pulseaudio
format-volume = <ramp-volume><label-volume>
label-volume = %percentage:3%
label-muted = ${icons.vol0}
format-muted-foreground = ${colors.foreground-alt}
format-muted = <label-muted>MUT

format-volume-background = ${self.format-background}
format-volume-padding = ${self.format-padding}
format-muted-padding = ${self.format-padding}

ramp-volume-foreground = ${colors.foreground-alt}

ramp-volume-0 = ${icons.vol1}
ramp-volume-1 = ${icons.vol2}
ramp-volume-2 = ${icons.vol3}

[module/update]
inherit = module/general
type = custom/script
format = <label>
label = "%output%"
format-prefix = ${icons.upd}
format-prefix-foreground = ${colors.foreground-alt}
exec = ~/.config/polybar/scripts/update.sh
exec-if = ping -c1 google.com
interval = 60

click-left = kitty yay &

[module/weather]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/weather.sh
interval = 5

[module/cputemp]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/hwmon.sh cpu
interval = 5
tail = false
;format-background = ${colors.background}
format-prefix = ${icons.cpu}
format-prefix-foreground = ${colors.foreground-alt}

[module/gpu]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/hwmon.sh gpu
format-prefix = ${icons.gpu}
format-prefix-foreground = ${colors.foreground-alt}
interval = 1
tail = false

[module/powermenu]
inherit = module/general
type = custom/menu

expand-right = false
format-background = ${colors.background}
label-open = ${icons.mopen}
label-open-foreground = ${colors.foreground-alt}
label-close = ${icons.mclose}
label-close-foreground = ${colors.foreground-alt}
label-separator = " "
label-foreground = ${colors.background}

menu-0-0 = ""
menu-0-0-exec = systemctl reboot
menu-0-1 = ""
menu-0-1-exec = systemctl poweroff
menu-0-2 = ""
menu-0-2-exec = systemctl suspend

[settings]
screenchange-reload = true
pseudo-transparency = true

[global/wm]
margin-top = 5
margin-bottom = 5
