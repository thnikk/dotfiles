; vim:ft=dosini
; Polybar config
; Most settings are inherited from the default bar.
;
; For easier configuration, icons, monitors, and colors were each broken into their own section.

[monitor]
main = DisplayPort-1
secondary = DisplayPort-2

[icons]
eth = "%{T3} %{T-}"
kbd = "%{T3} %{T-}"
mpc = "%{T3} %{T-}"
cpu = "%{T3} %{T-}"
mem = "%{T3} %{T-}"
upd = "%{T3} %{T-}"
vol = "%{T3} %{T-}"
clock = "%{T3} %{T-}"
date = "%{T3} %{T-}"
temp = "%{T3} %{T-}"
hot = "%{T3} %{T-}"
fan = "%{T3} %{T-}"
drv = "%{T3} %{T-}"
bat = "%{T3} %{T-}"
gpu = "%{T3} %{T-}"
vol0 = "%{T3} %{T-}"
vol1 = "%{T3} %{T-}"
vol2 = "%{T3} %{T-}"
vol3 = "%{T3} %{T-}"
mail = "%{T3} %{T-}"
vm = "%{T3} %{T-}"
twitch = "%{T3} %{T-}"
mopen = ""
mclose = ""

[colors]
background = #1c1f26
background-alt = #2b303b
foreground = #d8dee9
foreground-alt = #747C84
blue = #8fa1b3
purple = #b48ead
green = #a3be8c
orange = #d08770
brown = #ab7967
yellow = #ebcb8b
aqua = #96b5b4
red = #bf616a
blank = #00000000

[bar/default]
enable-ipc = true
override-redirect = false
wm-restack = bspwm
height = 30
offset-x = 0%
offset-y = 0%
fixed-center = true
bottom = true

tray-position = right
tray-background = ${colors.background}
#tray-padding = 1

border-top-size      = 0
border-bottom-size   = 0
border-left-size     = 0
border-right-size    = 0
border-color    = ${colors.blank}
radius          = 0
line-size       = 2

background = ${colors.background-alt}
foreground = ${colors.foreground}

padding-left = 0
padding-right = 0

separator = "%{B#1c1f26}%{F#747C84}|%{F-}%{B-}"

font-0 = Operator Mono Medium:pixelsize=14;3
font-1 = Source Han Sans JP:style=Bold:size=12:antialias=true;3
font-2 = Font Awesome 5 Free:style=Solid:pixelsize=12;3
font-4 = Font Awesome 5 Brands:pixelsize=12;3
font-3 = Operator Mono Light:pixelsize=6;

modules-left =  i3 bspwm keypad
modules-right = rec mpc weather unread update cpu temp mem kbd bat date

cursor-click = pointer
cursor-scroll = ns-resize

[bar/bar1]
enable-ipc = false
inherit = bar/default
monitor = ${monitor.main}
height = 30
background = ${colors.background-alt}

; Override module positioning
modules-left = i3 bspwm mpc keypad
modules-center =
modules-right = twitch vm unread update vol kbd net time

; Make fonts bigger
font-0 = Operator Mono Book:pixelsize=14;2
font-1 = Source Han Sans JP:size=10:antialias=true;1
font-2 = Material Icons:pixelsize=12;3

[bar/bar2]
enable-ipc = true
; Follow bar 1 since same system
inherit = bar/bar1
monitor = ${monitor.secondary}

; Override tray positioning
tray-position = right

; Override module placement
modules-left = i3 bspwm
modules-right = hwinfo mem
modules-center = gm

[module/general]
interval = 60
format-background = ${colors.background}
format-prefix-foreground = ${colors.foreground-alt}
format = <label>
format-padding = 6px

[module/vol]
inherit = module/general
type = custom/script
format-prefix = ${icons.vol3}
exec = ~/.config/polybar/scripts/vol.sh
tail = true
interval = 1
click-left = pamixer -t
scroll-up = pamixer -i 5
scroll-down = pamixer -d 5

[module/twitch]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.twitch}
format-prefix-foreground = ${colors.foreground-alt}
exec = ~/.config/polybar/scripts/twitch.sh "%{T3} %{T-}"
;exec-if = ~/.config/polybar/scripts/twitch.sh

[module/unread]
type = custom/script
inherit = module/general
format = <label>
format-prefix = ${icons.mail}
exec = ~/.config/polybar/scripts/unread.sh -p
interval = 1
click-left = $TERMINAL neomutt

[module/keypad]
inherit = module/general
type = custom/script
format = <label>
label = "%{A1:~/.local/bin/ukp 2k:}2K%{A} %{A1:~/.local/bin/ukp 4k:}4K%{A} %{A1:~/.local/bin/ukp 7k:}7K%{A} %{A1:~/.local/bin/ukp macro:}Macro%{A} %{A1:~/.local/bin/ukp 2kt:}2KT%{A} %{A1:~/.local/bin/ukp 4kt:}4KT %{A}%{A1:~/.local/bin/ukp fb:}FB%{A}"
exec = echo 1
exec-if = ls /dev/ttyACM*

interval = 1

[module/rec]
inherit = module/general
type = custom/script
format = <label>
label = "%output%"
format-foreground = ${colors.red}
exec = echo ""
exec-if = ps aux | grep ffmpeg | grep screencast | grep -v grep
interval = 1

[module/kbd]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.kbd}
format-prefix-foreground = ${colors.foreground-alt}
label = "%output%"
exec = /home/thnikk/.config/polybar/scripts/kb.sh -p
exec-if = pgrep ibus-daemon
interval = 1

[module/gm]
inherit = module/general
type = custom/script
format = <label>
label = %output%
exec = echo " Gamemode "
exec-if = gamemoded -s | grep "gamemode is active"
interval = 1
format-background = ${colors.red}

[module/ds4]
inherit = module/general
type = custom/script
format = <label>
format-prefix = " "
format-prefix-foreground = ${colors.foreground-alt}
label = %output%%
exec = cat "/sys/class/power_supply/sony_controller_battery*/capacity"
exec-if = cat "/sys/class/power_supply/sony_controller_battery*/capacity"
interval = 1

[module/bat]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.bat}
format-prefix-foreground = ${colors.foreground-alt}
format-foreground = ${colors.foreground}
exec = ~/.config/polybar/scripts/battery.sh
exec-if = test -d /sys/class/power_supply/BAT0
interval = 60

[module/storage]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.drv}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = df / | sed -n 2p | awk 'NR==1{print $5}'
interval = 10

[module/df]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.drv}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = ~/.config/polybar/scripts/df.sh
interval = 1

[module/time]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.clock}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = ~/.config/polybar/scripts/time.sh "%{T3} %{T-}"
interval = 60

[module/date]
inherit = module/general
type = internal/date
format-prefix = ${icons.clock}
format-prefix-foreground = ${colors.foreground-alt}
label = "%time%"
time = %I:%M
time-alt = %a,%{T3} %{T-}%m-%d-%y%{T3} %{T-}%I:%M

; Custom module for memory values more consistent with other programs
[module/mem]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.mem}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = ~/.config/polybar/scripts/mem.sh
interval = 5

; Custom module for listing active VMs
[module/vm]
inherit = module/general
type = custom/script
format-prefix = ${icons.vm}
exec = ~/.config/polybar/scripts/vm.sh -p
exec-if = sh -c "[ $HOST = thnikk-desktop ]"
interval = 5

[module/xwindow]
inherit = module/general
type = internal/xwindow
label = %title:0:30:...%

[module/xkeyboard]
inherit = module/general
type = internal/xkeyboard
blacklist-0 = num lock

format-prefix = "${icons.kbd}"
format-prefix-foreground = ${colors.foreground-alt}
format-prefix-underline = ${colors.blue}

label-layout = %layout%
label-layout-underline = ${colors.blue}

;label-indicator-padding = 2
;label-indicator-margin = 1
label-indicator-background = ${colors.blue}
label-indicator-underline = ${colors.blue}

;click-left = ~/.config/polybar/kbd.sh

[module/bspwm]
type = internal/bspwm
inherit = module/i3
label-empty =
label-occupied-padding-right = 1
label-occupied-background = ${colors.background}

[module/i3]
type = internal/i3
format = <label-state><label-mode>
index-sort = true
wrapping-scroll = false

; Only show workspaces on the same output as the bar
pin-workspaces = false

label-mode-foreground = ${colors.foreground}
label-mode-background = ${colors.red}

label-unfocused-padding-right = 1
label-unfocused-background = ${colors.background}

; focused = Active workspace on focused monitor
label-focused-padding-right = 1
label-focused-foreground = ${colors.background}
label-focused-background = ${colors.blue}

; visible = Active workspace on unfocused monitor
label-visible-foreground = ${colors.foreground}
label-visible-background = #3b404b
label-visible-padding-right = 1

; urgent = Workspace with urgency hint set
label-urgent-background = ${colors.red}
label-urgent-padding-right = 1

; Same as internal module default, but is disabled when song isn't playing
[module/mpc]
inherit = module/general
type = custom/script
format = <label>
format-prefix = ${icons.mpc}
format-prefix-foreground = ${colors.foreground-alt}
label = %output%
exec = mpc current -f %title%
tail = false
interval = 1

click-left = mpc toggle
scroll-up = mpc vol +5
scroll-down = mpc vol -5

[module/net]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/net.sh
format-prefix = ${icons.eth}
format-prefix-foreground = ${colors.foreground-alt}
interval = 60

[module/pulseaudio]
inherit = module/general
type = internal/pulseaudio
format-volume = <ramp-volume><label-volume>
label-volume = %percentage:2%
label-muted = ${icons.vol0}
format-muted-foreground = ${colors.foreground-alt}
format-muted = <label-muted>MUT

format-volume-background = ${self.format-background}
format-volume-padding = ${self.format-padding}
format-muted-padding = ${self.format-padding}

ramp-volume-foreground = ${colors.foreground-alt}

ramp-volume-0 = ${icons.vol1}
ramp-volume-1 = ${icons.vol2}
ramp-volume-2 = ${icons.vol3}

[module/update]
inherit = module/general
type = custom/script
format = <label>
label = "%output%"
format-prefix = ${icons.upd}
format-prefix-foreground = ${colors.foreground-alt}
exec = ~/.config/polybar/scripts/update.sh
exec-if = ping -c1 google.com
interval = 60

click-left = kitty yay &

[module/weather]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/weather.sh -p
interval = 5

[module/cpu]
inherit = module/general
type = internal/cpu
label=%percentage:2%%
format-prefix = ${icons.cpu}
interval = 0.5

; For easier use, use the helper script to symlink your cpu and gpu temperature files to ~/.config/polybar/<device>temp
[module/cputemp]
inherit = module/general
type = internal/temperature
interval = 0.5
thermal-zone = 0
hwmon-path = /home/thnikk/.config/polybar/cputemp
label=%temperature-c:2%
base-temperature = 20
warn-temperature = 80
format-prefix = ${icons.temp}
exec-if = test ~/.config/polybar/cputemp

[module/temp]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/temp.sh
interval = 5
tail = false
format-prefix = ${icons.temp}

[module/hwinfo]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/hwmon.sh cpu
interval = 5
tail = false
;format-background = ${colors.background}
format-prefix = ${icons.cpu}
;format-prefix-foreground = ${colors.foreground-alt}

[module/gpu]
inherit = module/general
type = custom/script
exec = ~/.config/polybar/scripts/hwmon.sh gpu
format-prefix = ${icons.gpu}
format-prefix-foreground = ${colors.foreground-alt}
interval = 1
tail = false

[module/powermenu]
inherit = module/general
type = custom/menu

expand-right = false
format-background = ${colors.background}
label-open = ${icons.mopen}
label-open-foreground = ${colors.foreground-alt}
label-close = ${icons.mclose}
label-close-foreground = ${colors.foreground-alt}
label-separator = " "
label-foreground = ${colors.background}

menu-0-0 = ""
menu-0-0-exec = systemctl reboot
menu-0-1 = ""
menu-0-1-exec = systemctl poweroff
menu-0-2 = ""
menu-0-2-exec = systemctl suspend

[settings]
screenchange-reload = true
pseudo-transparency = true
format-spacing = 0
format-margin = 0
format-offset = 0

[global/wm]
margin-top = 5
margin-bottom = 5
